# Artemis ç®¡ç†åŠŸèƒ½é›†æˆæµ‹è¯•

## æ¦‚è¿°

`test-management.sh` æ˜¯ä¸€ä¸ªå…¨é¢çš„ Artemis ç®¡ç†åŠŸèƒ½é›†æˆæµ‹è¯•è„šæœ¬,ç”¨äºéªŒè¯æ‰€æœ‰ç®¡ç† API çš„æ­£ç¡®æ€§ã€‚

## æµ‹è¯•è¦†ç›–

è¯¥è„šæœ¬æµ‹è¯• **6 å¤§ç®¡ç†æ¨¡å—**,å…± **29 ä¸ªæµ‹è¯•ç”¨ä¾‹**:

### ğŸ“¦ æ¨¡å—åˆ—è¡¨

| æ¨¡å— | æµ‹è¯•æ•° | åŠŸèƒ½æè¿° |
|------|--------|----------|
| **å®ä¾‹ç®¡ç†** (Instance Management) | 5 | å•å®ä¾‹æ‹‰å…¥/æ‹‰å‡ºã€çŠ¶æ€æŸ¥è¯¢ã€æ“ä½œå†å² |
| **æœåŠ¡å™¨ç®¡ç†** (Server Management) | 3 | æœåŠ¡å™¨çº§åˆ«æ‰¹é‡æ‹‰å…¥/æ‹‰å‡º |
| **Zoneç®¡ç†** (Zone Management) | 4 | Zoneçº§åˆ«æ‰¹é‡æ‹‰å…¥/æ‹‰å‡ºã€çŠ¶æ€ç®¡ç† |
| **é‡‘ä¸é›€å‘å¸ƒ** (Canary Deployment) | 5 | é‡‘ä¸é›€é…ç½®ã€IPç™½åå•ã€å¯ç”¨/ç¦ç”¨ |
| **åˆ†ç»„è·¯ç”±** (Group Routing) | 8 | åˆ†ç»„åˆ›å»ºã€è·¯ç”±è§„åˆ™ã€åŠ æƒç­–ç•¥ |
| **å®¡è®¡æ—¥å¿—** (Audit Logs) | 3 | æ“ä½œæ—¥å¿—æŸ¥è¯¢ |

## å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

1. **å¯åŠ¨ Artemis é›†ç¾¤**:
   ```bash
   ./cluster.sh start 3
   ```

2. **ç¡®ä¿æœåŠ¡å¥åº·**:
   ```bash
   curl http://localhost:8080/health
   ```

### è¿è¡Œæµ‹è¯•

#### 1. æµ‹è¯•æ‰€æœ‰æ¨¡å— (æ¨è)
```bash
./test-management.sh all
```

#### 2. æµ‹è¯•å•ä¸ªæ¨¡å—
```bash
# å®ä¾‹ç®¡ç†
./test-management.sh instance

# æœåŠ¡å™¨ç®¡ç†
./test-management.sh server

# Zoneç®¡ç†
./test-management.sh zone

# é‡‘ä¸é›€å‘å¸ƒ
./test-management.sh canary

# åˆ†ç»„è·¯ç”±
./test-management.sh routing

# å®¡è®¡æ—¥å¿—
./test-management.sh audit
```

## æµ‹è¯•ç»“æœç¤ºä¾‹

### æˆåŠŸè¾“å‡º
```
=========================================
æµ‹è¯•æ€»ç»“
=========================================
æ€»æµ‹è¯•æ•°: 29
é€šè¿‡: 29
å¤±è´¥: 0

âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡! ğŸ‰
```

### æ¨¡å—æµ‹è¯•è¾“å‡º
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  æ¨¡å—: å®ä¾‹ç®¡ç† (Instance Management)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

[æµ‹è¯• 2] æ‹‰å‡ºå•ä¸ªå®ä¾‹ (Pull Out)
âœ“ é€šè¿‡

[æµ‹è¯• 3] æŸ¥è¯¢å®ä¾‹æ˜¯å¦è¢«æ‹‰å‡º
âœ“ é€šè¿‡

[æµ‹è¯• 4] æŸ¥è¯¢å®ä¾‹æ“ä½œå†å²
âœ“ é€šè¿‡

[æµ‹è¯• 5] æ‹‰å…¥å®ä¾‹ (Pull In)
âœ“ é€šè¿‡

[æµ‹è¯• 6] éªŒè¯å®ä¾‹å·²æ‹‰å…¥
âœ“ é€šè¿‡
```

## æµ‹è¯•è¯¦æƒ…

### å®ä¾‹ç®¡ç† (Instance Management)

```bash
# æµ‹è¯•æµç¨‹
1. æ‹‰å‡ºå•ä¸ªå®ä¾‹ (Pull Out)
2. æŸ¥è¯¢å®ä¾‹æ˜¯å¦è¢«æ‹‰å‡º
3. æŸ¥è¯¢å®ä¾‹æ“ä½œå†å²
4. æ‹‰å…¥å®ä¾‹ (Pull In)
5. éªŒè¯å®ä¾‹å·²æ¢å¤
```

**API ç«¯ç‚¹**:
- `POST /api/management/instance/operate-instance.json`
- `POST /api/management/instance/is-instance-down.json`
- `POST /api/management/instance/get-instance-operations.json`

### æœåŠ¡å™¨ç®¡ç† (Server Management)

```bash
# æµ‹è¯•æµç¨‹
1. æ‹‰å‡ºæ•´ä¸ªæœåŠ¡å™¨ (æ‰€æœ‰å®ä¾‹)
2. æŸ¥è¯¢æœåŠ¡å™¨çŠ¶æ€
3. æ‹‰å…¥æœåŠ¡å™¨ (æ¢å¤æ‰€æœ‰å®ä¾‹)
```

**API ç«¯ç‚¹**:
- `POST /api/management/server/operate-server.json`
- `POST /api/management/server/is-server-down.json`

### Zoneç®¡ç† (Zone Management)

```bash
# æµ‹è¯•æµç¨‹
1. æ‹‰å‡ºæ•´ä¸ªZone (æ‰€æœ‰å®ä¾‹)
2. æŸ¥è¯¢ZoneçŠ¶æ€
3. æŸ¥è¯¢æ‰€æœ‰Zoneæ“ä½œè®°å½•
4. æ‹‰å…¥Zone (æ¢å¤æ‰€æœ‰å®ä¾‹)
```

**API ç«¯ç‚¹**:
- `POST /api/management/zone/pull-out`
- `POST /api/management/zone/pull-in`
- `GET /api/management/zone/status/:zone_id/:region_id`
- `GET /api/management/zone/operations`

### é‡‘ä¸é›€å‘å¸ƒ (Canary Deployment)

```bash
# æµ‹è¯•æµç¨‹
1. åˆ›å»ºé‡‘ä¸é›€é…ç½® (IPç™½åå•)
2. æŸ¥è¯¢é‡‘ä¸é›€é…ç½®
3. å¯ç”¨é‡‘ä¸é›€å‘å¸ƒ
4. æŸ¥è¯¢æ‰€æœ‰é‡‘ä¸é›€é…ç½®
5. åˆ é™¤é‡‘ä¸é›€é…ç½®
```

**API ç«¯ç‚¹**:
- `POST /api/management/canary/config`
- `GET /api/management/canary/config/:service_id`
- `POST /api/management/canary/enable`
- `GET /api/management/canary/configs`
- `DELETE /api/management/canary/config/:service_id`

### åˆ†ç»„è·¯ç”± (Group Routing)

```bash
# æµ‹è¯•æµç¨‹
1. åˆ›å»ºé‡‘ä¸é›€åˆ†ç»„
2. åˆ›å»ºç¨³å®šåˆ†ç»„
3. åˆ›å»ºåŠ æƒè·¯ç”±è§„åˆ™ (canary:10%, stable:90%)
4. æ·»åŠ é‡‘ä¸é›€åˆ†ç»„åˆ°è§„åˆ™ (æƒé‡10)
5. æ·»åŠ ç¨³å®šåˆ†ç»„åˆ°è§„åˆ™ (æƒé‡90)
6. å‘å¸ƒè·¯ç”±è§„åˆ™
7. æŸ¥è¯¢è§„åˆ™è¯¦æƒ…
8. åœç”¨è·¯ç”±è§„åˆ™
```

**API ç«¯ç‚¹**:
- `POST /api/routing/groups`
- `POST /api/routing/rules`
- `POST /api/routing/rules/:rule_id/groups`
- `POST /api/routing/rules/:rule_id/publish`
- `POST /api/routing/rules/:rule_id/unpublish`
- `GET /api/routing/rules/:rule_id`

### å®¡è®¡æ—¥å¿— (Audit Logs)

```bash
# æµ‹è¯•æµç¨‹
1. æŸ¥è¯¢æ‰€æœ‰å®¡è®¡æ—¥å¿—
2. æŸ¥è¯¢å®ä¾‹æ“ä½œæ—¥å¿—
3. æŸ¥è¯¢æœåŠ¡å™¨æ“ä½œæ—¥å¿—
```

**API ç«¯ç‚¹**:
- `GET /api/management/audit/logs`
- `GET /api/management/audit/instance-logs`
- `GET /api/management/audit/server-logs`

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡å™¨æœªå¯åŠ¨
```
é”™è¯¯: æœåŠ¡å™¨å¯åŠ¨è¶…æ—¶
è§£å†³: ./cluster.sh start 3
```

#### 2. ç«¯å£å†²çª
```
é”™è¯¯: ç«¯å£ 8080 å·²è¢«å ç”¨
è§£å†³: ./cluster.sh stop && ./cluster.sh start 3
```

#### 3. æµ‹è¯•æ•°æ®å†²çª
```
é”™è¯¯: Group already exists
è§£å†³: é‡å¯é›†ç¾¤æ¸…ç©ºå†…å­˜æ•°æ®
      ./cluster.sh stop && ./cluster.sh start 3
```

## ç¯å¢ƒå˜é‡

è„šæœ¬ä½¿ç”¨ä»¥ä¸‹ç¯å¢ƒå˜é‡(å¯è‡ªå®šä¹‰):

```bash
BASE_URL="http://localhost:8080"      # Artemis æœåŠ¡å™¨åœ°å€
SERVICE_ID="test-mgmt-service"        # æµ‹è¯•æœåŠ¡ID
REGION_ID="us-east"                   # æµ‹è¯•Region
ZONE_ID="zone-1"                      # ä¸»Zone
ZONE_ID_2="zone-2"                    # è¾…åŠ©Zone
```

## æµ‹è¯•æ•°æ®

è„šæœ¬ä¼šè‡ªåŠ¨:
1. **å‡†å¤‡é˜¶æ®µ**: æ³¨å†Œ 5 ä¸ªæµ‹è¯•å®ä¾‹ (zone-1: 3ä¸ª, zone-2: 2ä¸ª)
2. **æµ‹è¯•é˜¶æ®µ**: å¯¹å®ä¾‹æ‰§è¡Œå„ç§ç®¡ç†æ“ä½œ
3. **æ¸…ç†é˜¶æ®µ**: åˆ é™¤æ‰€æœ‰æµ‹è¯•æ•°æ® (åˆ†ç»„ã€è§„åˆ™ã€é…ç½®)

## è¾“å‡ºæ ¼å¼

æµ‹è¯•è„šæœ¬ä½¿ç”¨é¢œè‰²æ ‡è®°:
- ğŸŸ¢ **ç»¿è‰²**: æµ‹è¯•é€šè¿‡
- ğŸ”´ **çº¢è‰²**: æµ‹è¯•å¤±è´¥
- ğŸŸ¡ **é»„è‰²**: æµ‹è¯•æ­¥éª¤
- ğŸ”µ **è“è‰²**: æ¨¡å—æ ‡é¢˜
- ğŸ”· **é’è‰²**: ç« èŠ‚æ ‡é¢˜

## é€€å‡ºç 

- `0`: æ‰€æœ‰æµ‹è¯•é€šè¿‡
- `1`: æœ‰æµ‹è¯•å¤±è´¥æˆ–æœåŠ¡å™¨å¯åŠ¨å¤±è´¥

## æ³¨æ„äº‹é¡¹

1. **é›†ç¾¤æ¨¡å¼**: è„šæœ¬é»˜è®¤è¿æ¥åˆ° `localhost:8080`,é€‚ç”¨äºé›†ç¾¤ç¯å¢ƒ
2. **æ•°æ®éš”ç¦»**: ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æœåŠ¡ID,ä¸ä¼šå½±å“ç”Ÿäº§æ•°æ®
3. **è‡ªåŠ¨æ¸…ç†**: æµ‹è¯•ç»“æŸåè‡ªåŠ¨æ¸…ç†æ‰€æœ‰æµ‹è¯•æ•°æ®
4. **å¹‚ç­‰æ€§**: å¯ä»¥é‡å¤è¿è¡Œ,æ¯æ¬¡éƒ½ä¼šæ¸…ç†æ—§æ•°æ®

## è´¡çŒ®

å¦‚éœ€æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹:
1. åœ¨å¯¹åº”æ¨¡å—å‡½æ•°ä¸­æ·»åŠ æµ‹è¯•æ­¥éª¤
2. æ›´æ–° `TOTAL_TESTS` è®¡æ•°
3. åœ¨ `cleanup_test_data()` ä¸­æ·»åŠ æ¸…ç†é€»è¾‘

## è®¸å¯è¯

MIT OR Apache-2.0
